@model List<Stores.Models.StoreAccountApplication>

<h2>Applications</h2>

@if (TempData["Success"] != null)
{
    <div class="alert alert-success">
        @TempData["Success"]
    </div>
}

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">
        @TempData["Error"]
    </div>
}

<div class="applications-container">
    @foreach (var application in Model)
    {
        @if (application.VerificationStatusId == 1)
        {
            <div class="application-card mb-4 p-3 border rounded">
                <h4>Application #@application.Id - Store Name: @application.StoreName</h4>
                
                <hr/>
                
                <h6 style="text-decoration: underline"><strong>Business Info:</strong></h6>
                
                <p><strong>Category:</strong> @application.StoreCategory.Name</p>
                <p><strong>Address:</strong> @application.StoreAddress</p>
                <p><strong>City:</strong> @application.StoreCity</p>
                <p><strong>Tax Registration Number (TRN):</strong> @application.StoreTaxRegistrationNumber</p>
                <p><strong>Commercial Registration Number (CRN):</strong> @application.StoreCommercialRegistrationNumber</p>
                    
                <hr/>
                    
                <h6 style="text-decoration: underline"><strong>Contact Info:</strong></h6>
                    
                <p><strong>Phone:</strong> @application.StorePhone</p>
                <p><strong>Email:</strong> @application.StoreEmail</p>
                    
                <form asp-action="Create" asp-controller="Store" method="post" class="d-inline">
                    <input type="hidden" name="applicationId" value="@application.Id"/>
                    <button
                        type="submit"
                        class="approve-application-btn btn btn-primary btn-sm"
                        onclick="return confirm('Are you sure about approving this application?')">
                        Approve
                    </button>
                </form>
                    
                <button type="button" 
                        class="reject-application-btn btn btn-danger btn-sm" 
                        data-bs-toggle="modal" 
                        data-bs-target="#rejectModal-@application.Id">
                    Reject
                </button>
                    
                <div class="modal fade" id="rejectModal-@application.Id" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form asp-action="Reject" asp-controller="StoreAccountApplication" method="post">
                                <div class="modal-header">
                                    <h5 class="modal-title">Reject Application #@application.Id</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body">
                                    <input type="hidden" name="applicationId" value="@application.Id" />
                                    <div class="mb-3">
                                        <label for="feedback-@application.Id" class="form-label">Feedback (required)</label>
                                        <textarea class="form-control" name="feedback" id="feedback-@application.Id" required></textarea>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="submit" class="btn btn-danger">Confirm Reject</button>
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        }
    }
</div>

<script src="~/js/site.js"></script>